/* eslint-disable */

// Ported from WebCola/cola.js and overrode jaccardLinkLengths()

function unionCount(a, b) {
  var u = {};
  for (var i in a) u[i] = {};
  for (var i in b) u[i] = {};
  return Object.keys(u).length;
}

function intersectionCount(a, b) {
  var n = 0;
  for (var i in a) if (typeof b[i] !== "undefined") ++n;
  return n;
}

function getNeighbours(links, la) {
  var neighbours = {};
  var addNeighbours = function (u, v) {
    if (typeof neighbours[u] === "undefined") neighbours[u] = {};
    neighbours[u][v] = {};
  };
  links.forEach(function (e) {
    var u = la.getSourceIndex(e),
      v = la.getTargetIndex(e);
    addNeighbours(u, v);
    addNeighbours(v, u);
  });
  return neighbours;
}

function computeLinkLengths(links, w, f, la) {
  var neighbours = getNeighbours(links, la);
  links.forEach(function (l) {
    var a = neighbours[la.getSourceIndex(l)];
    var b = neighbours[la.getTargetIndex(l)];
    la.setLength(l, 1 + w * f(a, b));
  });
}

function jaccardLinkLengths(links, la, w) {
  if (w === void 0) {
    w = 1;
  }
  computeLinkLengths(
    links,
    w,
    function (a, b) {
      return Math.min(Object.keys(a).length, Object.keys(b).length) < 1.1
        ? 0
        : 1 - intersectionCount(a, b) / unionCount(a, b);
    },
    la,
  );
}

cola.Layout.prototype.jaccardLinkLengths = function (idealLength, w) {
  var _this = this;
  if (w === void 0) {
    w = 1;
  }
  this.linkDistance(function (l) {
    return idealLength * l.length;
  });
  this._linkLengthCalculator = function () {
    return jaccardLinkLengths(_this._links, _this.linkAccessor, w);
  };
  return this;
};
