!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],e);else{var s="object"==typeof exports?e(require("d3")):e(t.d3);for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(self,(t=>(()=>{"use strict";var e={893:e=>{e.exports=t}},s={};function i(t){var r=s[t];if(void 0!==r)return r.exports;var o=s[t]={exports:{}};return e[t](o,o.exports,i),o.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};i.r(r),i.d(r,{RemovableNodePlugin:()=>x,default:()=>f});var o=i(893);class a{constructor(t,e){this.data=t,this.extraKey=e}get(t){return this.slice(t).filter((t=>"string"==typeof t.value))}slice(t){return this.data?this.extraKey?this.sliceWithExtraKey(t):this.sliceWithoutExtraKey(t):[]}sliceWithExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&this.data[t][this.extraKey]&&e.push({class:t,value:this.data[t][this.extraKey]})})),e}sliceWithoutExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&e.push({class:t,value:this.data[t]})})),e}}function n(t){return t.replace(" ","-").toLowerCase()}class l{constructor(t,e,s){this.id=e,this.options=s,this.name=t.name,this.group="string"==typeof t.group?[t.group]:t.group||[],this.icon=t.icon,this.metaList=new a(t.meta).get(s.metaKeys),this.meta=t.meta,this.extraClass=t.class||"",this.width=s.width||60,this.height=s.height||40,this.padding=3,this.tspanOffset="1.1em",this.register(e)}register(t){p.all=p.all||{},p.all[this.name]=t}transform(){return`translate(${this.x-this.width/2+this.padding}, ${this.y-this.height/2+this.padding})`}nodeWidth(){return this.width-2*this.padding}nodeHeight(){return this.height-2*this.padding}xForText(){return this.width/2}yForText(){return this.height/2}static idByName(t){if(void 0===p.all[t])throw`Unknown node "${t}"`;return p.all[t]}nodeId(){return n(this.name)}static render(t,e){const s=t.selectAll(".node").data(e).enter().append("g").attr("id",(t=>t.nodeId())).attr("name",(t=>t.name)).attr("transform",(t=>t.transform()));return s.each((function(t){t.icon?p.appendImage(this):p.appendRect(this),p.appendText(this)})),s}static appendText(t){const e=o.select(t).append("text").attr("text-anchor","middle").attr("x",(t=>t.xForText())).attr("y",(t=>t.yForText()));e.append("tspan").text((t=>t.name)).attr("x",(t=>t.xForText())),e.each((t=>{t.options.tooltip||p.appendMetaText(e,t.metaList)}))}static appendMetaText(t,e){e.forEach((e=>{t.append("tspan").attr("x",(t=>t.xForText())).attr("dy",(t=>t.tspanOffset)).attr("class",e.class).text(e.value)}))}static appendImage(t){o.select(t).attr("class",(t=>`node image ${n(t.name)} ${t.extraClass}`)).append("image").attr("xlink:href",(t=>t.icon)).attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight()))}static appendRect(t){o.select(t).attr("class",(t=>`node rect ${n(t.name)} ${t.extraClass}`)).append("rect").attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight())).attr("rx",5).attr("ry",5).style("fill",(t=>t.options.color(void 0)))}static tick(t){t.attr("transform",(t=>t.transform()))}static setPosition(t,e){t.attr("transform",((t,s)=>{var i,r,o,a;return null!==(null===(i=e[s])||void 0===i?void 0:i.x)&&void 0!==(null===(r=e[s])||void 0===r?void 0:r.x)&&null!==(null===(o=e[s])||void 0===o?void 0:o.y)&&void 0!==(null===(a=e[s])||void 0===a?void 0:a.y)&&(t.x=e[s].x,t.y=e[s].y),t.transform()}))}static reset(){p.all=null}}const d=t=>class extends t{constructor(t,e,s){super(t,e,s),this.dispatch=o.dispatch("rendered")}static render(t,e){const s=super.render(t,e);return s.each((function(t){t.dispatch.rendered(this)})),s}on(t,e){this.dispatch.on(t,e)}},c=t=>{class e extends t{constructor(t,s,i){super(t,s,i);for(const r of e.pluginConstructors)r.bind(this)(t,s,i)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class h extends(d(l)){}class p extends(c(h)){}var u;class y extends p{toggleSelected(){this.selected=!this.selected}reset(){this.selected=!1}textColor(){return this.selected?"red":"black"}}const x=(u=class{static load(t,e,s,i={}){i.showKey&&(u.showKey=i.showKey),i.hideKey&&(u.hideKey=i.hideKey),e.registerConstructor((function(t,e,s){this.selected=!1,this.on("rendered",(t=>{u.configureRemovableNode(t)}))})),u.configureRemovableNodes(),e.prototype.toggleSelected=y.prototype.toggleSelected,e.prototype.reset=y.prototype.reset,e.prototype.textColor=y.prototype.textColor}static configureRemovableNodes(){o.select("body").on("keydown",(()=>{switch(o.event.key){case u.showKey:u.show();break;case u.hideKey:u.hide()}}))}static configureRemovableNode(t){o.select(t).on("click.removableNode",(function(t){o.event.defaultPrevented||(t.toggleSelected(),u.applyColor(this))}))}static applyColor(t){o.select(t).select("text tspan").style("fill",(t=>t.textColor()))}static show(){o.selectAll(".node").style("display","inline").each((function(t){t.reset(),u.applyColor(this)})),u.showLinks()}static hide(){o.selectAll(".node").style("display",(t=>t.selected?(u.hideLinks(t.name),u.hideToolTips(t.name),"none"):"inline"))}static showLinks(){o.selectAll(".link").style("display","inline")}static hideLinks(t){o.selectAll(`.link.${n(t)}`).style("display","none")}static hideToolTips(t){o.selectAll(`.tooltip.${n(t)}`).attr("visibility","hidden")}},u.showKey="Escape",u.hideKey="d",u),f=x;return r})()));
//# sourceMappingURL=plugin.min.js.map