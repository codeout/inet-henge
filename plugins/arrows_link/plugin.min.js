!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],e);else{var s="object"==typeof exports?e(require("d3")):e(t.d3);for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(self,(t=>(()=>{"use strict";var e={893:e=>{e.exports=t}},s={};function r(t){var a=s[t];if(void 0!==a)return a.exports;var i=s[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};r.r(a),r.d(a,{ArrowsLinkPlugin:()=>v,default:()=>M});var i=r(893);class n{constructor(t,e){this.id=e,this.links=t,this.color="#7a4e4e",this.width=2,this.space=4}static divide(t){n.groups={};for(const e of t)if(e.bundle){const t=this.groupKey(e);(n.groups[t]||(n.groups[t]=[])).push(e.id)}return Object.values(n.groups).map(((e,s)=>new n(e.map((e=>t[e])),s)))}static groupKey(t){return JSON.stringify([t.source,t.target,t.bundle])}static render(t,e){return t.selectAll(".bundle").data(e).enter().append("g").attr("class",(t=>t.class())).append("path").attr("d",(t=>t.d())).attr("stroke",(t=>t.color)).attr("stroke-width",(t=>t.width)).attr("fill","none").attr("id",(t=>t.bundleId()))}static reset(){n.groups=null}static sortByBundle(t){return t.sort(((t,e)=>{switch(!0){case!!t.bundle&&!e.bundle:return-1;case!t.bundle&&!!e.bundle:return 1;case!t.bundle&&!e.bundle:return 0;case t.bundle.toString()<e.bundle.toString():return-1;case t.bundle.toString()>e.bundle.toString():return 1;default:return 0}}))}d(){const t=this.links[0].centerCoordinates(),e=this.links[this.links.length-1].centerCoordinates(),s=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2));if(0===s)return"";const r=this.links[0].angle()+90,a=[(t[0]-e[0])*this.space/s+t[0],(t[1]-e[1])*this.space/s+t[1]],i=[(e[0]-t[0])*this.space/s+e[0],(e[1]-t[1])*this.space/s+e[1]];return`M ${a[0]} ${a[1]} A ${s/2+10},5 ${r} 1,0 ${i[0]} ${i[1]}`}shiftMultiplier(){if(!this._shiftMultiplier){const t=this.links[0].group()||[];this._shiftMultiplier=this.links.reduce(((e,s)=>e+(s.id-(t.length-1)/2)),0)/2}return this._shiftMultiplier}static shiftBundle(t){t.attr("d",(t=>t.d()))}class(){return this.links[0].class().replace(/^link/,"bundle")}bundleId(){return`bundle${this.id}`}}class o{constructor(t,e){this.data=t,this.extraKey=e}get(t){return this.slice(t).filter((t=>"string"==typeof t.value))}slice(t){return this.data?this.extraKey?this.sliceWithExtraKey(t):this.sliceWithoutExtraKey(t):[]}sliceWithExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&this.data[t][this.extraKey]&&e.push({class:t,value:this.data[t][this.extraKey]})})),e}sliceWithoutExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&e.push({class:t,value:this.data[t]})})),e}}function l(t){return t.replace(" ","-").toLowerCase()}class h{constructor(t,e,s){this.id=e,this.options=s,this.name=t.name,this.group="string"==typeof t.group?[t.group]:t.group||[],this.icon=t.icon,this.metaList=new o(t.meta).get(s.metaKeys),this.meta=t.meta,this.extraClass=t.class||"",this.width=s.width||60,this.height=s.height||40,this.padding=3,this.tspanOffset="1.1em",this.register(e)}register(t){p.all=p.all||{},p.all[this.name]=t}transform(){return`translate(${this.x-this.width/2+this.padding}, ${this.y-this.height/2+this.padding})`}nodeWidth(){return this.width-2*this.padding}nodeHeight(){return this.height-2*this.padding}xForText(){return this.width/2}yForText(){return this.height/2}static idByName(t){if(void 0===p.all[t])throw`Unknown node "${t}"`;return p.all[t]}nodeId(){return l(this.name)}static render(t,e){const s=t.selectAll(".node").data(e).enter().append("g").attr("id",(t=>t.nodeId())).attr("name",(t=>t.name)).attr("transform",(t=>t.transform()));return s.each((function(t){t.icon?p.appendImage(this):p.appendRect(this),p.appendText(this)})),s}static appendText(t){const e=i.select(t).append("text").attr("text-anchor","middle").attr("x",(t=>t.xForText())).attr("y",(t=>t.yForText()));e.append("tspan").text((t=>t.name)).attr("x",(t=>t.xForText())),e.each((t=>{t.options.tooltip||p.appendMetaText(e,t.metaList)}))}static appendMetaText(t,e){e.forEach((e=>{t.append("tspan").attr("x",(t=>t.xForText())).attr("dy",(t=>t.tspanOffset)).attr("class",e.class).text(e.value)}))}static appendImage(t){i.select(t).attr("class",(t=>`node image ${l(t.name)} ${t.extraClass}`)).append("image").attr("xlink:href",(t=>t.icon)).attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight()))}static appendRect(t){i.select(t).attr("class",(t=>`node rect ${l(t.name)} ${t.extraClass}`)).append("rect").attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight())).attr("rx",5).attr("ry",5).style("fill",(t=>t.options.color(void 0)))}static tick(t){t.attr("transform",(t=>t.transform()))}static setPosition(t,e){t.attr("transform",((t,s)=>{var r,a,i,n;return null!==(null===(r=e[s])||void 0===r?void 0:r.x)&&void 0!==(null===(a=e[s])||void 0===a?void 0:a.x)&&null!==(null===(i=e[s])||void 0===i?void 0:i.y)&&void 0!==(null===(n=e[s])||void 0===n?void 0:n.y)&&(t.x=e[s].x,t.y=e[s].y),t.transform()}))}static reset(){p.all=null}}const d=t=>class extends t{constructor(t,e,s){super(t,e,s),this.dispatch=i.dispatch("rendered")}static render(t,e){const s=super.render(t,e);return s.each((function(t){t.dispatch.rendered(this)})),s}on(t,e){this.dispatch.on(t,e)}},c=t=>{class e extends t{constructor(t,s,r){super(t,s,r);for(const a of e.pluginConstructors)a.bind(this)(t,s,r)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class u extends(d(h)){}class p extends(c(u)){}class g{constructor(t,e,s){this.id=e,this.options=s,this.source=p.idByName(t.source),this.target=p.idByName(t.target),this.bundle=t.bundle,this.metaList=new o(t.meta).get(s.metaKeys),this.sourceMeta=new o(t.meta,"source").get(s.metaKeys),this.targetMeta=new o(t.meta,"target").get(s.metaKeys),this.extraClass=t.class||"","function"==typeof s.linkWidth?this.width=s.linkWidth(t.meta)||3:this.width=s.linkWidth||3,this.defaultMargin=15,this.labelXOffset=20,this.labelYOffset=1.5,this.color="#7a4e4e",this.register(e)}register(t){y.groups=y.groups||{};const e=[this.source,this.target].sort().toString();(y.groups[e]||(y.groups[e]=[])).push(t)}isLabelledPath(){return this.metaList.length>0}isReversePath(){return this.targetMeta.length>0}d(){return`M ${this.source.x} ${this.source.y} L ${this.target.x} ${this.target.y}`}pathId(){return`path${this.id}`}linkId(){return`link${this.id}`}margin(){if(!this._margin){const t=window.getComputedStyle(document.getElementById(this.linkId())).margin;this._margin=t&&"0px"!==t?parseInt(t):this.defaultMargin}return this._margin}isLabelVisible(){const t=document.getElementById(this.pathId()).getTotalLength(),e=Array.from(document.getElementsByClassName(this.pathId())).some((e=>{const s=e.firstChild;return s.classList.contains("center")?s.getComputedTextLength()>t:s.getComputedTextLength()+this.labelXOffset>t}));return i.selectAll(`text.${this.pathId()}`).classed("short",e),y.scale>1.5&&!e}group(){return y.groups[[this.source.id,this.target.id].sort().toString()]}tspanXOffset(){switch(!0){case this.isLabelledPath():return 0;case this.isReversePath():return-this.labelXOffset;default:return this.labelXOffset}}tspanYOffset(){return this.isLabelledPath()?.7-this.labelYOffset+"em":`${this.labelYOffset}em`}rotate(t){return this.source.x>this.target.x?`rotate(180 ${t.x+t.width/2} ${t.y+t.height/2})`:"rotate(0)"}split(){if(!this.metaList&&!this.sourceMeta&&!this.targetMeta)return[this];const t=[];return["metaList","sourceMeta","targetMeta"].forEach(((e,s,r)=>{if(this[e]){const s=Object.assign(Object.create(this),this);r.filter((t=>t!==e)).forEach((t=>s[t]=[])),t.push(s)}})),t}hasMeta(){return this.metaList.length>0||this.sourceMeta.length>0||this.targetMeta.length>0}class(){return`link ${l(this.source.name)} ${l(this.target.name)} ${l(this.source.name)}-${l(this.target.name)} ${this.extraClass}`}centerCoordinates(){const t=i.select(`.link #${this.linkId()}`).node(),e=t.getBBox(),s=t.transform.baseVal.consolidate();return[e.x+e.width/2+((null==s?void 0:s.matrix.e)||0),e.y+e.height/2+((null==s?void 0:s.matrix.f)||0)]}angle(){const t=i.select(`.link #${this.linkId()}`).node();return 180*Math.atan2(t.y2.baseVal.value-t.y1.baseVal.value,t.x2.baseVal.value-t.x1.baseVal.value)/Math.PI}static render(t,e,s){const r=t.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),a=r.append("line").attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)).attr("stroke",(t=>t.color)).attr("stroke-width",(t=>t.width)).attr("id",(t=>t.linkId())).on("mouseover.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!0))).on("mouseout.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!1))),i=r.append("path").attr("d",(t=>t.d())).attr("id",(t=>t.pathId())),n=e.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),o=n.selectAll("text").data((t=>t.split().filter((t=>t.hasMeta())))).enter().append("text").attr("class",(t=>t.pathId()));return o.append("textPath").attr("xlink:href",(t=>`#${t.pathId()}`)).each((function(t){y.appendMetaText(this,t.metaList),y.appendMetaText(this,t.sourceMeta),y.appendMetaText(this,t.targetMeta),t.isLabelledPath()&&y.center(this),t.isReversePath()&&y.theOtherEnd(this)})),y.zoom(),[a,i,o]}static theOtherEnd(t){i.select(t).attr("class","reverse").attr("text-anchor","end").attr("startOffset","100%")}static center(t){i.select(t).attr("class","center").attr("text-anchor","middle").attr("startOffset","50%")}static appendMetaText(t,e){e.forEach((e=>{i.select(t).append("tspan").attr("x",(t=>t.tspanXOffset())).attr("dy",(t=>t.tspanYOffset())).attr("class",e.class).text(e.value)}))}static tick(t,e,s){t.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),e.attr("d",(t=>t.d())),s.attr("transform",(function(t){return t.rotate(this.getBBox())})),i.selectAll(".link text").style("visibility",(t=>t.isLabelVisible()?"visible":"hidden"))}static zoom(t){y.scale=t,i.selectAll(".link text").style("visibility",(t=>t.isLabelVisible()?"visible":"hidden"))}static setPosition(t,e){t.attr("x1",((t,s)=>e[s].x1)).attr("y1",((t,s)=>e[s].y1)).attr("x2",((t,s)=>e[s].x2)).attr("y2",((t,s)=>e[s].y2))}shiftMultiplier(){if(!this._shiftMultiplier){const t=this.group()||[];this._shiftMultiplier=t.indexOf(this.id)-(t.length-1)/2}return this._shiftMultiplier}static shiftBundle(t,e,s,r){const a=t=>t.shiftBundle(t.shiftMultiplier());t.attr("transform",a),e.attr("transform",a),s.attr("transform",a),n.shiftBundle(r)}shiftBundle(t){const e=this.margin()*t,s=this.target.x-this.source.x,r=this.target.y-this.source.y,a=Math.sqrt(Math.pow(s,2)+Math.pow(r,2));return`translate(${-e*r/a}, ${e*s/a})`}static reset(){y.groups=null}}const f=t=>class extends t{constructor(t,e,s){super(t,e,s),this.dispatch=i.dispatch("rendered")}static render(t,e,s){const[r,a,i]=super.render(t,e,s);return r.each((function(t){t.dispatch.rendered(this)})),[r,a,i]}on(t,e){this.dispatch.on(t,e)}},x=t=>{class e extends t{constructor(t,s,r){super(t,s,r);for(const a of e.pluginConstructors)a.bind(this)(t,s,r)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class m extends(f(g)){}class y extends(x(m)){}var b;class k extends y{static tick(t,e,s){super.tick(t,e,s),t.attr("x2",(t=>t.x2())),t.attr("y2",(t=>t.y2()))}length(){return Math.sqrt((this.source.x-this.target.x)**2+(this.source.y-this.target.y)**2)}x2(){return this.source.x+(.5-5/this.length())*(this.target.x-this.source.x)}y2(){return this.source.y+(.5-5/this.length())*(this.target.y-this.source.y)}}const v=(b=class{static load(t,e,s){s.registerConstructor((function(t,e,s,r){this.selected=!1,this.on("rendered",(t=>{b.appendMarker(t),b.isMarkerDefined||b.defineMarkers()}))})),s.tick=k.tick,s.prototype.length=k.prototype.length,s.prototype.x2=k.prototype.x2,s.prototype.y2=k.prototype.y2}static defineMarkers(){const t=i.select("svg").append("defs"),e=e=>{t.append("marker").attr("id",e).attr("markerWidth",10).attr("markerHeight",7).attr("refX",7.5).attr("orient","auto").attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5 L10,0 L0,5")};e("marker-odd"),e("marker-even"),b.isMarkerDefined=!0}static appendMarker(t){i.select(t).attr("marker-end",(t=>t.id%2==0?"url(#marker-odd)":"url(#marker-even)"))}},b.isMarkerDefined=!1,b),M=v;return a})()));
//# sourceMappingURL=plugin.min.js.map