!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],e);else{var r="object"==typeof exports?e(require("d3")):e(t.d3);for(var s in r)("object"==typeof exports?exports:t)[s]=r[s]}}(window,(function(t){return function(t){var e={};function r(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,function(e){return t[e]}.bind(null,a));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(e,r){e.exports=t},function(t,e,r){"use strict";r.r(e),r.d(e,"ArrowsLinkPlugin",(function(){return y}));var s=r(0);class a{constructor(t,e){this.data=t,this.extraKey=e}get(t){return this.slice(t).filter(t=>"string"==typeof t.value)}slice(t){return this.data?this.extraKey?this.sliceWithExtraKey(t):this.sliceWithoutExtraKey(t):[]}sliceWithExtraKey(t){const e=[];return t.forEach(t=>{this.data[t]&&this.data[t][this.extraKey]&&e.push({class:t,value:this.data[t][this.extraKey]})}),e}sliceWithoutExtraKey(t){const e=[];return t.forEach(t=>{this.data[t]&&e.push({class:t,value:this.data[t]})}),e}}function i(t){return t.replace(" ","-").toLowerCase()}class n{constructor(t,e,r,s,i){this.id=e,this.color=s,this.tooltip=i,this.name=t.name,this.group="string"==typeof t.group?[t.group]:t.group||[],this.icon=t.icon,this.meta=new a(t.meta).get(r),this.extraClass=t.class||"",this.width=60,this.height=40,this.padding=3,this.tspanOffset="1.1em",this.register(e,t.name)}register(t,e){d.all=d.all||{},d.all[e]=t}transform(){return`translate(${this.x-this.width/2+this.padding}, ${this.y-this.height/2+this.padding})`}nodeWidth(){return this.width-2*this.padding}nodeHeight(){return this.height-2*this.padding}xForText(){return this.width/2}yForText(){return this.height/2}static idByName(t){if(void 0===d.all[t])throw`Unknown node "${t}"`;return d.all[t]}static render(t,e){const r=t.selectAll(".node").data(e).enter().append("g").attr("id",t=>i(t.name)).attr("name",t=>t.name).attr("transform",t=>t.transform());return r.each((function(t){t.icon?d.appendImage(this):d.appendRect(this),d.appendText(this)})),r}static appendText(t){const e=s.select(t).append("text").attr("text-anchor","middle").attr("x",t=>t.xForText()).attr("y",t=>t.yForText());e.append("tspan").text(t=>t.name).attr("x",t=>t.xForText()),e.each(t=>{t.tooltip||d.appendTspans(e,t.meta)})}static appendTspans(t,e){e.forEach(e=>{t.append("tspan").attr("x",t=>t.xForText()).attr("dy",t=>t.tspanOffset).attr("class",e.class).text(e.value)})}static appendImage(t){s.select(t).attr("class",t=>`node image ${i(t.name)} ${t.extraClass}`).append("image").attr("xlink:href",t=>t.icon).attr("width",t=>t.nodeWidth()).attr("height",t=>t.nodeHeight())}static appendRect(t){s.select(t).attr("class",t=>`node rect ${i(t.name)} ${t.extraClass}`).append("rect").attr("width",t=>t.nodeWidth()).attr("height",t=>t.nodeHeight()).attr("rx",5).attr("ry",5).style("fill",t=>t.color())}static tick(t){t.attr("transform",t=>t.transform())}static setPosition(t,e){t.attr("transform",(t,r)=>(t.x=e[r].x,t.y=e[r].y,t.transform()))}static reset(){d.all=null}}const o=t=>class extends t{constructor(t,e,r,a,i){super(t,e,r,a,i),this.dispatch=s.dispatch("rendered")}static render(t,e){const r=super.render(t,e);return r.each((function(t){t.dispatch.rendered(this)})),r}on(t,e){this.dispatch.on(t,e)}},h=t=>{class e extends t{constructor(t,r,s,a,i){super(t,r,s,a,i);for(const n of e.pluginConstructors)n.bind(this)(t,r,s,a,i)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class c extends(o(n)){}class d extends(h(c)){}class l{constructor(t,e,r,s){this.id=e,this.source=d.idByName(t.source),this.target=d.idByName(t.target),this.meta=new a(t.meta).get(r),this.sourceMeta=new a(t.meta,"source").get(r),this.targetMeta=new a(t.meta,"target").get(r),this.extraClass=t.class||"",this.width="function"==typeof s?s(t.meta)||3:s||3,this.defaultMargin=15,this.labelXOffset=20,this.labelYOffset=1.5,this.color="#7a4e4e",this.register(e,this.source,this.target)}isNamedPath(){return this.meta.length>0}isReversePath(){return this.targetMeta.length>0}d(){return`M ${this.source.x} ${this.source.y} L ${this.target.x} ${this.target.y}`}pathId(){return"path"+this.id}linkId(){return"link"+this.id}margin(){if(!this._margin){const t=window.getComputedStyle(document.getElementById(this.linkId())).margin;this._margin=t&&"0px"!==t?parseInt(t):this.defaultMargin}return this._margin}tspanXOffset(){return this.isNamedPath()?0:this.isReversePath()?-this.labelXOffset:this.labelXOffset}tspanYOffset(){return this.isNamedPath()?.7-this.labelYOffset+"em":this.labelYOffset+"em"}rotate(t){return this.source.x>this.target.x?`rotate(180 ${t.x+t.width/2} ${t.y+t.height/2})`:"rotate(0)"}split(){if(!this.meta&&!this.sourceMeta&&!this.targetMeta)return[this];const t=[];return["meta","sourceMeta","targetMeta"].forEach((e,r,s)=>{if(this[e]){const r=Object.assign(Object.create(this),this);s.filter(t=>t!==e).forEach(t=>r[t]=[]),t.push(r)}}),t}hasMeta(){return this.meta.length>0||this.sourceMeta.length>0||this.targetMeta.length>0}class(){return`link ${i(this.source.name)} ${i(this.target.name)} ${i(this.source.name)}-${i(this.target.name)} ${this.extraClass}`}static render(t,e,r){const s=t.selectAll(".link").data(r).enter().append("g").attr("class",t=>t.class()),a=s.append("line").attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y).attr("stroke",t=>t.color).attr("stroke-width",t=>t.width).attr("id",t=>t.linkId()).on("mouseover.line",t=>n.selectAll("text."+t.pathId()).classed("hover",!0)).on("mouseout.line",t=>n.selectAll("text."+t.pathId()).classed("hover",!1)),i=s.append("path").attr("d",t=>t.d()).attr("id",t=>t.pathId()),n=e.selectAll(".link").data(r).enter().append("g").attr("class",t=>t.class()),o=n.selectAll("text").data(t=>t.split().filter(t=>t.hasMeta())).enter().append("text").attr("class",t=>t.pathId());return o.append("textPath").attr("xlink:href",t=>"#"+t.pathId()).each((function(t){g.appendTspans(this,t.meta),g.appendTspans(this,t.sourceMeta),g.appendTspans(this,t.targetMeta),t.isNamedPath()&&g.center(this),t.isReversePath()&&g.theOtherEnd(this)})),g.zoom(),[a,i,o]}static theOtherEnd(t){s.select(t).attr("class","reverse").attr("text-anchor","end").attr("startOffset","100%")}static center(t){s.select(t).attr("class","center").attr("text-anchor","middle").attr("startOffset","50%")}static appendTspans(t,e){e.forEach(e=>{s.select(t).append("tspan").attr("x",t=>t.tspanXOffset()).attr("dy",t=>t.tspanYOffset()).attr("class",e.class).text(e.value)})}static tick(t,e,r){t.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),e&&e.attr("d",t=>t.d()),r&&r.attr("transform",(function(t){return t.rotate(this.getBBox())}))}static zoom(t){let e="hidden";t&&t>1.5&&(e="visible"),s.selectAll(".link text").style("visibility",e)}static setPosition(t,e){t.attr("x1",(t,r)=>e[r].x1).attr("y1",(t,r)=>e[r].y1).attr("x2",(t,r)=>e[r].x2).attr("y2",(t,r)=>e[r].y2)}register(t,e,r){g.groups=g.groups||{};const s=[e,r].sort().toString();g.groups[s]=g.groups[s]||[],g.groups[s].push(t)}static shiftMultiplier(t){const e=g.groups[[t.source.id,t.target.id].sort().toString()]||[];return e.indexOf(t.id)-(e.length-1)/2}static shiftBundle(t,e,r){const s=t=>t.shiftBundle(g.shiftMultiplier(t));t.attr("transform",s),e.attr("transform",s),r.attr("transform",s)}shiftBundle(t){const e=this.margin()*t,r=Math.abs(this.target.x-this.source.x),s=Math.abs(this.source.y-this.target.y),a=Math.sqrt(Math.pow(r,2)+Math.pow(s,2));return`translate(${e*s/a}, ${e*r/a})`}static reset(){g.groups=null}}const u=t=>class extends t{constructor(t,e,r,a){super(t,e,r,a),this.dispatch=s.dispatch("rendered")}static render(t,e,r){const[s,a,i]=super.render(t,e,r);return s.each((function(t){t.dispatch.rendered(this)})),[s,a,i]}on(t,e){this.dispatch.on(t,e)}},p=t=>{class e extends t{constructor(t,r,s,a){super(t,r,s,a);for(const i of e.pluginConstructors)i.bind(this)(t,r,s,a)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class f extends(u(l)){}class g extends(p(f)){}var x;class m extends g{static tick(t,e,r){super.tick(t,e,r),t.attr("x2",t=>t.x2()),t.attr("y2",t=>t.y2())}length(){return Math.sqrt((this.source.x-this.target.x)**2+(this.source.y-this.target.y)**2)}x2(){return this.source.x+(.5-5/this.length())*(this.target.x-this.source.x)}y2(){return this.source.y+(.5-5/this.length())*(this.target.y-this.source.y)}}const y=((x=class t{static load(e,r,s){s.registerConstructor((function(e,r,s,a){this.selected=!1,this.on("rendered",e=>{t.appendMarker(e),t.isMarkerDefined||t.defineMarkers()})})),s.tick=m.tick,s.prototype.length=m.prototype.length,s.prototype.x2=m.prototype.x2,s.prototype.y2=m.prototype.y2}static defineMarkers(){const e=s.select("svg").append("defs"),r=t=>{e.append("marker").attr("id",t).attr("markerWidth",10).attr("markerHeight",7).attr("refX",7.5).attr("orient","auto").attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5 L10,0 L0,5")};r("marker-odd"),r("marker-even"),t.isMarkerDefined=!0}static appendMarker(t){s.select(t).attr("marker-end",t=>t.id%2==0?"url(#marker-odd)":"url(#marker-even)")}}).isMarkerDefined=!1,x);e.default=y}])}));
//# sourceMappingURL=plugin.min.js.map