!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],e);else{var s="object"==typeof exports?e(require("d3")):e(t.d3);for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(self,(t=>(()=>{"use strict";var e={990:e=>{e.exports=t}},s={};function r(t){var a=s[t];if(void 0!==a)return a.exports;var i=s[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{r.r(a),r.d(a,{ArrowsLinkPlugin:()=>m,default:()=>y});var t=r(990);class e{constructor(t,e){this.data=t,this.extraKey=e}get(t){return this.slice(t).filter((t=>"string"==typeof t.value))}slice(t){return this.data?this.extraKey?this.sliceWithExtraKey(t):this.sliceWithoutExtraKey(t):[]}sliceWithExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&this.data[t][this.extraKey]&&e.push({class:t,value:this.data[t][this.extraKey]})})),e}sliceWithoutExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&e.push({class:t,value:this.data[t]})})),e}}function s(t){return t.replace(" ","-").toLowerCase()}class i{constructor(t,s,r){this.id=s,this.options=r,this.name=t.name,this.group="string"==typeof t.group?[t.group]:t.group||[],this.icon=t.icon,this.metaList=new e(t.meta).get(r.metaKeys),this.meta=t.meta,this.extraClass=t.class||"",this.width=r.width||60,this.height=r.height||40,this.padding=3,this.tspanOffset="1.1em",this.register(s,t.name)}register(t,e){c.all=c.all||{},c.all[e]=t}transform(){return`translate(${this.x-this.width/2+this.padding}, ${this.y-this.height/2+this.padding})`}nodeWidth(){return this.width-2*this.padding}nodeHeight(){return this.height-2*this.padding}xForText(){return this.width/2}yForText(){return this.height/2}static idByName(t){if(void 0===c.all[t])throw`Unknown node "${t}"`;return c.all[t]}static render(t,e){const r=t.selectAll(".node").data(e).enter().append("g").attr("id",(t=>s(t.name))).attr("name",(t=>t.name)).attr("transform",(t=>t.transform()));return r.each((function(t){t.icon?c.appendImage(this):c.appendRect(this),c.appendText(this)})),r}static appendText(e){const s=t.select(e).append("text").attr("text-anchor","middle").attr("x",(t=>t.xForText())).attr("y",(t=>t.yForText()));s.append("tspan").text((t=>t.name)).attr("x",(t=>t.xForText())),s.each((t=>{t.options.tooltip||c.appendTspans(s,t.metaList)}))}static appendTspans(t,e){e.forEach((e=>{t.append("tspan").attr("x",(t=>t.xForText())).attr("dy",(t=>t.tspanOffset)).attr("class",e.class).text(e.value)}))}static appendImage(e){t.select(e).attr("class",(t=>`node image ${s(t.name)} ${t.extraClass}`)).append("image").attr("xlink:href",(t=>t.icon)).attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight()))}static appendRect(e){t.select(e).attr("class",(t=>`node rect ${s(t.name)} ${t.extraClass}`)).append("rect").attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight())).attr("rx",5).attr("ry",5).style("fill",(t=>t.options.color(void 0)))}static tick(t){t.attr("transform",(t=>t.transform()))}static setPosition(t,e){t.attr("transform",((t,s)=>(t.x=e[s].x,t.y=e[s].y,t.transform())))}static reset(){c.all=null}}const n=e=>class extends e{constructor(e,s,r){super(e,s,r),this.dispatch=t.dispatch("rendered")}static render(t,e){const s=super.render(t,e);return s.each((function(t){t.dispatch.rendered(this)})),s}on(t,e){this.dispatch.on(t,e)}},o=t=>{class e extends t{constructor(t,s,r){super(t,s,r);for(const a of e.pluginConstructors)a.bind(this)(t,s,r)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class h extends(n(i)){}class c extends(o(h)){}class d{constructor(t,s,r,a){this.id=s,this.source=c.idByName(t.source),this.target=c.idByName(t.target),this.metaList=new e(t.meta).get(r),this.sourceMeta=new e(t.meta,"source").get(r),this.targetMeta=new e(t.meta,"target").get(r),this.extraClass=t.class||"",this.width="function"==typeof a?a(t.meta)||3:a||3,this.defaultMargin=15,this.labelXOffset=20,this.labelYOffset=1.5,this.color="#7a4e4e",this.register(s,this.source,this.target)}isNamedPath(){return this.metaList.length>0}isReversePath(){return this.targetMeta.length>0}d(){return`M ${this.source.x} ${this.source.y} L ${this.target.x} ${this.target.y}`}pathId(){return`path${this.id}`}linkId(){return`link${this.id}`}margin(){if(!this._margin){const t=window.getComputedStyle(document.getElementById(this.linkId())).margin;this._margin=t&&"0px"!==t?parseInt(t):this.defaultMargin}return this._margin}tspanXOffset(){return this.isNamedPath()?0:this.isReversePath()?-this.labelXOffset:this.labelXOffset}tspanYOffset(){return this.isNamedPath()?.7-this.labelYOffset+"em":`${this.labelYOffset}em`}rotate(t){return this.source.x>this.target.x?`rotate(180 ${t.x+t.width/2} ${t.y+t.height/2})`:"rotate(0)"}split(){if(!this.metaList&&!this.sourceMeta&&!this.targetMeta)return[this];const t=[];return["metaList","sourceMeta","targetMeta"].forEach(((e,s,r)=>{if(this[e]){const s=Object.assign(Object.create(this),this);r.filter((t=>t!==e)).forEach((t=>s[t]=[])),t.push(s)}})),t}hasMeta(){return this.metaList.length>0||this.sourceMeta.length>0||this.targetMeta.length>0}class(){return`link ${s(this.source.name)} ${s(this.target.name)} ${s(this.source.name)}-${s(this.target.name)} ${this.extraClass}`}static render(t,e,s){const r=t.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),a=r.append("line").attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)).attr("stroke",(t=>t.color)).attr("stroke-width",(t=>t.width)).attr("id",(t=>t.linkId())).on("mouseover.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!0))).on("mouseout.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!1))),i=r.append("path").attr("d",(t=>t.d())).attr("id",(t=>t.pathId())),n=e.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),o=n.selectAll("text").data((t=>t.split().filter((t=>t.hasMeta())))).enter().append("text").attr("class",(t=>t.pathId()));return o.append("textPath").attr("xlink:href",(t=>`#${t.pathId()}`)).each((function(t){g.appendTspans(this,t.metaList),g.appendTspans(this,t.sourceMeta),g.appendTspans(this,t.targetMeta),t.isNamedPath()&&g.center(this),t.isReversePath()&&g.theOtherEnd(this)})),g.zoom(),[a,i,o]}static theOtherEnd(e){t.select(e).attr("class","reverse").attr("text-anchor","end").attr("startOffset","100%")}static center(e){t.select(e).attr("class","center").attr("text-anchor","middle").attr("startOffset","50%")}static appendTspans(e,s){s.forEach((s=>{t.select(e).append("tspan").attr("x",(t=>t.tspanXOffset())).attr("dy",(t=>t.tspanYOffset())).attr("class",s.class).text(s.value)}))}static tick(t,e,s){t.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),e&&e.attr("d",(t=>t.d())),s&&s.attr("transform",(function(t){return t.rotate(this.getBBox())}))}static zoom(e){let s="hidden";e&&e>1.5&&(s="visible"),t.selectAll(".link text").style("visibility",s)}static setPosition(t,e){t.attr("x1",((t,s)=>e[s].x1)).attr("y1",((t,s)=>e[s].y1)).attr("x2",((t,s)=>e[s].x2)).attr("y2",((t,s)=>e[s].y2))}register(t,e,s){g.groups=g.groups||{};const r=[e,s].sort().toString();g.groups[r]=g.groups[r]||[],g.groups[r].push(t)}static shiftMultiplier(t){const e=g.groups[[t.source.id,t.target.id].sort().toString()]||[];return e.indexOf(t.id)-(e.length-1)/2}static shiftBundle(t,e,s){const r=t=>t.shiftBundle(g.shiftMultiplier(t));t.attr("transform",r),e.attr("transform",r),s.attr("transform",r)}shiftBundle(t){const e=this.margin()*t,s=Math.abs(this.target.x-this.source.x),r=Math.abs(this.source.y-this.target.y),a=Math.sqrt(Math.pow(s,2)+Math.pow(r,2));return`translate(${e*r/a}, ${e*s/a})`}static reset(){g.groups=null}}const l=e=>class extends e{constructor(e,s,r,a){super(e,s,r,a),this.dispatch=t.dispatch("rendered")}static render(t,e,s){const[r,a,i]=super.render(t,e,s);return r.each((function(t){t.dispatch.rendered(this)})),[r,a,i]}on(t,e){this.dispatch.on(t,e)}},p=t=>{class e extends t{constructor(t,s,r,a){super(t,s,r,a);for(const i of e.pluginConstructors)i.bind(this)(t,s,r,a)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class u extends(l(d)){}class g extends(p(u)){}var f;class x extends g{static tick(t,e,s){super.tick(t,e,s),t.attr("x2",(t=>t.x2())),t.attr("y2",(t=>t.y2()))}length(){return Math.sqrt((this.source.x-this.target.x)**2+(this.source.y-this.target.y)**2)}x2(){return this.source.x+(.5-5/this.length())*(this.target.x-this.source.x)}y2(){return this.source.y+(.5-5/this.length())*(this.target.y-this.source.y)}}const m=(f=class e{static load(t,s,r){r.registerConstructor((function(t,s,r,a){this.selected=!1,this.on("rendered",(t=>{e.appendMarker(t),e.isMarkerDefined||e.defineMarkers()}))})),r.tick=x.tick,r.prototype.length=x.prototype.length,r.prototype.x2=x.prototype.x2,r.prototype.y2=x.prototype.y2}static defineMarkers(){const s=t.select("svg").append("defs"),r=t=>{s.append("marker").attr("id",t).attr("markerWidth",10).attr("markerHeight",7).attr("refX",7.5).attr("orient","auto").attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5 L10,0 L0,5")};r("marker-odd"),r("marker-even"),e.isMarkerDefined=!0}static appendMarker(e){t.select(e).attr("marker-end",(t=>t.id%2==0?"url(#marker-odd)":"url(#marker-even)"))}},f.isMarkerDefined=!1,f),y=m})(),a})()));
//# sourceMappingURL=plugin.min.js.map