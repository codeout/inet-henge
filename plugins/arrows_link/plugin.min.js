!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("d3"));else if("function"==typeof define&&define.amd)define(["d3"],e);else{var s="object"==typeof exports?e(require("d3")):e(t.d3);for(var r in s)("object"==typeof exports?exports:t)[r]=s[r]}}(self,(t=>(()=>{"use strict";var e={990:e=>{e.exports=t}},s={};function r(t){var a=s[t];if(void 0!==a)return a.exports;var i=s[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var s in e)r.o(e,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{r.r(a),r.d(a,{ArrowsLinkPlugin:()=>y,default:()=>b});var t=r(990);class e{constructor(t,e){this.id=e,this.links=t,this.color="#7a4e4e",this.width=2,this.space=4}static divide(t){e.groups={};for(const s of t)if(s.bundle){const t=this.groupKey(s);(e.groups[t]||(e.groups[t]=[])).push(s.id)}return Object.values(e.groups).map(((s,r)=>new e(s.map((e=>t[e])),r)))}static groupKey(t){return JSON.stringify([t.source,t.target,t.bundle])}static render(t,e){return t.selectAll(".bundle").data(e).enter().append("g").attr("class",(t=>t.class())).append("path").attr("d",(t=>t.d())).attr("stroke",(t=>t.color)).attr("stroke-width",(t=>t.width)).attr("fill","none").attr("id",(t=>t.bundleId()))}static reset(){e.groups=null}static sortByBundle(t){return t.sort(((t,e)=>{switch(!0){case!!t.bundle&&!e.bundle:return-1;case!t.bundle&&!!e.bundle:return 1;case!t.bundle&&!e.bundle:return 0;case t.bundle.toString()<e.bundle.toString():return-1;case t.bundle.toString()>e.bundle.toString():return 1;default:return 0}}))}d(){const t=this.links[0].centerCoordinates(),e=this.links[this.links.length-1].centerCoordinates(),s=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2));if(0===s)return"";const r=this.links[0].angle()+90,a=[(t[0]-e[0])*this.space/s+t[0],(t[1]-e[1])*this.space/s+t[1]],i=[(e[0]-t[0])*this.space/s+e[0],(e[1]-t[1])*this.space/s+e[1]];return`M ${a[0]} ${a[1]} A ${s/2+10},5 ${r} 1,0 ${i[0]} ${i[1]}`}shiftMultiplier(){if(!this._shiftMultiplier){const t=this.links[0].group()||[];this._shiftMultiplier=this.links.reduce(((e,s)=>e+(s.id-(t.length-1)/2)),0)/2}return this._shiftMultiplier}static shiftBundle(t){t.attr("d",(t=>t.d()))}class(){return this.links[0].class().replace(/^link/,"bundle")}bundleId(){return`bundle${this.id}`}}class s{constructor(t,e){this.data=t,this.extraKey=e}get(t){return this.slice(t).filter((t=>"string"==typeof t.value))}slice(t){return this.data?this.extraKey?this.sliceWithExtraKey(t):this.sliceWithoutExtraKey(t):[]}sliceWithExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&this.data[t][this.extraKey]&&e.push({class:t,value:this.data[t][this.extraKey]})})),e}sliceWithoutExtraKey(t){const e=[];return t.forEach((t=>{this.data[t]&&e.push({class:t,value:this.data[t]})})),e}}function i(t){return t.replace(" ","-").toLowerCase()}class n{constructor(t,e,r){this.id=e,this.options=r,this.name=t.name,this.group="string"==typeof t.group?[t.group]:t.group||[],this.icon=t.icon,this.metaList=new s(t.meta).get(r.metaKeys),this.meta=t.meta,this.extraClass=t.class||"",this.width=r.width||60,this.height=r.height||40,this.padding=3,this.tspanOffset="1.1em",this.register(e)}register(t){d.all=d.all||{},d.all[this.name]=t}transform(){return`translate(${this.x-this.width/2+this.padding}, ${this.y-this.height/2+this.padding})`}nodeWidth(){return this.width-2*this.padding}nodeHeight(){return this.height-2*this.padding}xForText(){return this.width/2}yForText(){return this.height/2}static idByName(t){if(void 0===d.all[t])throw`Unknown node "${t}"`;return d.all[t]}nodeId(){return i(this.name)}static render(t,e){const s=t.selectAll(".node").data(e).enter().append("g").attr("id",(t=>t.nodeId())).attr("name",(t=>t.name)).attr("transform",(t=>t.transform()));return s.each((function(t){t.icon?d.appendImage(this):d.appendRect(this),d.appendText(this)})),s}static appendText(e){const s=t.select(e).append("text").attr("text-anchor","middle").attr("x",(t=>t.xForText())).attr("y",(t=>t.yForText()));s.append("tspan").text((t=>t.name)).attr("x",(t=>t.xForText())),s.each((t=>{t.options.tooltip||d.appendMetaText(s,t.metaList)}))}static appendMetaText(t,e){e.forEach((e=>{t.append("tspan").attr("x",(t=>t.xForText())).attr("dy",(t=>t.tspanOffset)).attr("class",e.class).text(e.value)}))}static appendImage(e){t.select(e).attr("class",(t=>`node image ${i(t.name)} ${t.extraClass}`)).append("image").attr("xlink:href",(t=>t.icon)).attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight()))}static appendRect(e){t.select(e).attr("class",(t=>`node rect ${i(t.name)} ${t.extraClass}`)).append("rect").attr("width",(t=>t.nodeWidth())).attr("height",(t=>t.nodeHeight())).attr("rx",5).attr("ry",5).style("fill",(t=>t.options.color(void 0)))}static tick(t){t.attr("transform",(t=>t.transform()))}static setPosition(t,e){t.attr("transform",((t,s)=>{var r,a,i,n;return null!==(null===(r=e[s])||void 0===r?void 0:r.x)&&void 0!==(null===(a=e[s])||void 0===a?void 0:a.x)&&null!==(null===(i=e[s])||void 0===i?void 0:i.y)&&void 0!==(null===(n=e[s])||void 0===n?void 0:n.y)&&(t.x=e[s].x,t.y=e[s].y),t.transform()}))}static reset(){d.all=null}}const o=e=>class extends e{constructor(e,s,r){super(e,s,r),this.dispatch=t.dispatch("rendered")}static render(t,e){const s=super.render(t,e);return s.each((function(t){t.dispatch.rendered(this)})),s}on(t,e){this.dispatch.on(t,e)}},h=t=>{class e extends t{constructor(t,s,r){super(t,s,r);for(const a of e.pluginConstructors)a.bind(this)(t,s,r)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class l extends(o(n)){}class d extends(h(l)){}class c{constructor(t,e,r){this.id=e,this.options=r,this.source=d.idByName(t.source),this.target=d.idByName(t.target),this.bundle=t.bundle,this.metaList=new s(t.meta).get(r.metaKeys),this.sourceMeta=new s(t.meta,"source").get(r.metaKeys),this.targetMeta=new s(t.meta,"target").get(r.metaKeys),this.extraClass=t.class||"","function"==typeof r.linkWidth?this.width=r.linkWidth(t.meta)||3:this.width=r.linkWidth||3,this.defaultMargin=15,this.labelXOffset=20,this.labelYOffset=1.5,this.color="#7a4e4e",this.register(e)}register(t){f.groups=f.groups||{};const e=[this.source,this.target].sort().toString();(f.groups[e]||(f.groups[e]=[])).push(t)}isLabelledPath(){return this.metaList.length>0}isReversePath(){return this.targetMeta.length>0}d(){return`M ${this.source.x} ${this.source.y} L ${this.target.x} ${this.target.y}`}pathId(){return`path${this.id}`}linkId(){return`link${this.id}`}margin(){if(!this._margin){const t=window.getComputedStyle(document.getElementById(this.linkId())).margin;this._margin=t&&"0px"!==t?parseInt(t):this.defaultMargin}return this._margin}group(){return f.groups[[this.source.id,this.target.id].sort().toString()]}tspanXOffset(){switch(!0){case this.isLabelledPath():return 0;case this.isReversePath():return-this.labelXOffset;default:return this.labelXOffset}}tspanYOffset(){return this.isLabelledPath()?.7-this.labelYOffset+"em":`${this.labelYOffset}em`}rotate(t){return this.source.x>this.target.x?`rotate(180 ${t.x+t.width/2} ${t.y+t.height/2})`:"rotate(0)"}split(){if(!this.metaList&&!this.sourceMeta&&!this.targetMeta)return[this];const t=[];return["metaList","sourceMeta","targetMeta"].forEach(((e,s,r)=>{if(this[e]){const s=Object.assign(Object.create(this),this);r.filter((t=>t!==e)).forEach((t=>s[t]=[])),t.push(s)}})),t}hasMeta(){return this.metaList.length>0||this.sourceMeta.length>0||this.targetMeta.length>0}class(){return`link ${i(this.source.name)} ${i(this.target.name)} ${i(this.source.name)}-${i(this.target.name)} ${this.extraClass}`}centerCoordinates(){const e=t.select(`.link #${this.linkId()}`).node(),s=e.getBBox(),r=e.transform.baseVal.consolidate();return[s.x+s.width/2+((null==r?void 0:r.matrix.e)||0),s.y+s.height/2+((null==r?void 0:r.matrix.f)||0)]}angle(){const e=t.select(`.link #${this.linkId()}`).node();return 180*Math.atan2(e.y2.baseVal.value-e.y1.baseVal.value,e.x2.baseVal.value-e.x1.baseVal.value)/Math.PI}static render(t,e,s){const r=t.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),a=r.append("line").attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)).attr("stroke",(t=>t.color)).attr("stroke-width",(t=>t.width)).attr("id",(t=>t.linkId())).on("mouseover.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!0))).on("mouseout.line",(t=>n.selectAll(`text.${t.pathId()}`).classed("hover",!1))),i=r.append("path").attr("d",(t=>t.d())).attr("id",(t=>t.pathId())),n=e.selectAll(".link").data(s).enter().append("g").attr("class",(t=>t.class())),o=n.selectAll("text").data((t=>t.split().filter((t=>t.hasMeta())))).enter().append("text").attr("class",(t=>t.pathId()));return o.append("textPath").attr("xlink:href",(t=>`#${t.pathId()}`)).each((function(t){f.appendMetaText(this,t.metaList),f.appendMetaText(this,t.sourceMeta),f.appendMetaText(this,t.targetMeta),t.isLabelledPath()&&f.center(this),t.isReversePath()&&f.theOtherEnd(this)})),f.zoom(),[a,i,o]}static theOtherEnd(e){t.select(e).attr("class","reverse").attr("text-anchor","end").attr("startOffset","100%")}static center(e){t.select(e).attr("class","center").attr("text-anchor","middle").attr("startOffset","50%")}static appendMetaText(e,s){s.forEach((s=>{t.select(e).append("tspan").attr("x",(t=>t.tspanXOffset())).attr("dy",(t=>t.tspanYOffset())).attr("class",s.class).text(s.value)}))}static tick(t,e,s){t.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),e&&e.attr("d",(t=>t.d())),s&&s.attr("transform",(function(t){return t.rotate(this.getBBox())}))}static zoom(e){let s="hidden";e&&e>1.5&&(s="visible"),t.selectAll(".link text").style("visibility",s)}static setPosition(t,e){t.attr("x1",((t,s)=>e[s].x1)).attr("y1",((t,s)=>e[s].y1)).attr("x2",((t,s)=>e[s].x2)).attr("y2",((t,s)=>e[s].y2))}shiftMultiplier(){if(!this._shiftMultiplier){const t=this.group()||[];this._shiftMultiplier=t.indexOf(this.id)-(t.length-1)/2}return this._shiftMultiplier}static shiftBundle(t,s,r,a){const i=t=>t.shiftBundle(t.shiftMultiplier());t.attr("transform",i),s.attr("transform",i),r.attr("transform",i),e.shiftBundle(a)}shiftBundle(t){const e=this.margin()*t,s=this.target.x-this.source.x,r=this.target.y-this.source.y,a=Math.sqrt(Math.pow(s,2)+Math.pow(r,2));return`translate(${-e*r/a}, ${e*s/a})`}static reset(){f.groups=null}}const u=e=>class extends e{constructor(e,s,r){super(e,s,r),this.dispatch=t.dispatch("rendered")}static render(t,e,s){const[r,a,i]=super.render(t,e,s);return r.each((function(t){t.dispatch.rendered(this)})),[r,a,i]}on(t,e){this.dispatch.on(t,e)}},p=t=>{class e extends t{constructor(t,s,r){super(t,s,r);for(const a of e.pluginConstructors)a.bind(this)(t,s,r)}static registerConstructor(t){e.pluginConstructors.push(t)}}return e.pluginConstructors=[],e};class g extends(u(c)){}class f extends(p(g)){}var x;class m extends f{static tick(t,e,s){super.tick(t,e,s),t.attr("x2",(t=>t.x2())),t.attr("y2",(t=>t.y2()))}length(){return Math.sqrt((this.source.x-this.target.x)**2+(this.source.y-this.target.y)**2)}x2(){return this.source.x+(.5-5/this.length())*(this.target.x-this.source.x)}y2(){return this.source.y+(.5-5/this.length())*(this.target.y-this.source.y)}}const y=(x=class e{static load(t,s,r){r.registerConstructor((function(t,s,r,a){this.selected=!1,this.on("rendered",(t=>{e.appendMarker(t),e.isMarkerDefined||e.defineMarkers()}))})),r.tick=m.tick,r.prototype.length=m.prototype.length,r.prototype.x2=m.prototype.x2,r.prototype.y2=m.prototype.y2}static defineMarkers(){const s=t.select("svg").append("defs"),r=t=>{s.append("marker").attr("id",t).attr("markerWidth",10).attr("markerHeight",7).attr("refX",7.5).attr("orient","auto").attr("viewBox","0 -5 10 10").append("path").attr("d","M0,-5 L10,0 L0,5")};r("marker-odd"),r("marker-even"),e.isMarkerDefined=!0}static appendMarker(e){t.select(e).attr("marker-end",(t=>t.id%2==0?"url(#marker-odd)":"url(#marker-even)"))}},x.isMarkerDefined=!1,x),b=y})(),a})()));
//# sourceMappingURL=plugin.min.js.map